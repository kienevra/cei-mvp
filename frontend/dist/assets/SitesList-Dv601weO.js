import{j as e,r as i,u as h,L as b}from"./index-DWKqlycP.js";import{u as p,g as j,d as f}from"./sites-DtG1IDw5.js";import{E as g}from"./ErrorBanner--am66j-U.js";import{P as y}from"./PageHeader-CbgFYcYC.js";const N=({columns:a,data:n})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border",children:[e.jsx("thead",{children:e.jsx("tr",{children:a.map(t=>e.jsx("th",{className:"px-3 py-2 border-b bg-gray-50 text-left text-xs font-semibold",children:t.label},t.key))})}),e.jsxs("tbody",{children:[n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:a.length,className:"text-center text-gray-400 py-4",children:"No data."})}),n.map((t,r)=>e.jsx("tr",{className:"hover:bg-gray-50",children:a.map(l=>e.jsx("td",{className:"px-3 py-2 border-b",children:t[l.key]},l.key))},r))]})]})}),w=({open:a,onClose:n,title:t,children:r})=>{const l=i.useRef(null);return i.useEffect(()=>{a&&l.current?.focus()},[a]),a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30","aria-modal":"true",role:"dialog",tabIndex:-1,onClick:n,children:e.jsxs("div",{className:"bg-white rounded shadow p-6 min-w-[300px] max-w-[90vw]",onClick:c=>c.stopPropagation(),ref:l,tabIndex:0,"aria-label":t,children:[t&&e.jsx("div",{className:"font-bold mb-2",children:t}),r]})}):null},k=[{key:"name",label:"Name"},{key:"location",label:"Location"},{key:"status",label:"Status"},{key:"updated_at",label:"Last Updated"},{key:"actions",label:"Actions"}],D=()=>{const{data:a,loading:n,error:t,refetch:r}=p(j),[l,c]=i.useState(""),[d,o]=i.useState(null),x=h(),m=i.useMemo(()=>(a||[]).filter(s=>s.name.toLowerCase().includes(l.toLowerCase())||(s.location||"").toLowerCase().includes(l.toLowerCase())),[a,l]),u=async s=>{o(null);try{await f(s),r()}catch{alert("Delete failed. Rolling back."),r()}};return e.jsxs("div",{children:[e.jsx(y,{title:"Sites"}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-2 items-center",children:[e.jsx("input",{className:"border rounded px-2 py-1",placeholder:"Search sites...",value:l,onChange:s=>c(s.target.value)}),e.jsx("button",{className:"ml-auto bg-green-600 text-white px-4 py-1 rounded",onClick:()=>x("/sites/new"),children:"+ New Site"})]}),n&&e.jsx(b,{}),t&&e.jsx(g,{error:t}),e.jsx(N,{columns:k,data:m.map(s=>({...s,actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"text-blue-600",onClick:()=>x(`/sites/${s.id}`),children:"View"}),e.jsx("button",{className:"text-yellow-600",onClick:()=>x(`/sites/${s.id}/edit`),children:"Edit"}),e.jsx("button",{className:"text-red-600",onClick:()=>o(s.id),children:"Delete"})]})}))}),e.jsxs(w,{open:!!d,onClose:()=>o(null),title:"Confirm Delete",children:[e.jsx("div",{children:"Are you sure you want to delete this site?"}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{className:"bg-red-600 text-white px-4 py-1 rounded",onClick:()=>d&&u(d),children:"Delete"}),e.jsx("button",{className:"bg-gray-200 px-4 py-1 rounded",onClick:()=>o(null),children:"Cancel"})]})]})]})};export{D as default};
